# spp-net

参考：https://zhuanlan.zhihu.com/p/24774302

### 引入空间金字塔池化改进RCNN

#### 在RCNN中CNN阶段流程大致如下：

![](https://pic1.zhimg.com/80/v2-e33c609edc8647a326392a27ff24489b_hd.jpg)

红色框为selective search输出的可能包含物体的候选框（ROI）

一张图图片会有2k左右个候选框，每一个都要单独输入CNN做卷积等操作会很费时。SPP-NET提出：能否在feature-map上提取RO特征，这样就只需要在整幅图上做一次卷积

![](https://pic1.zhimg.com/80/v2-7d5d06d0553d6dab106588ec4654df15_hd.jpg)

虽然总体流程还是selective search得到候选区域->CNN提取ROI特征（Region of Interest）->类别判断->位置精修，SPP-NET则是直接在图片上进行CNN特征提取，大大减少了重复的卷积操作，提高了效率。（注意这里和CNN网络的区别：CNN在卷积后连接全连接层让提取后的各个子图能够相互作用，最终得出单一的结果，因为我们做的数据集为单类别的image和label，而这里是提取后的各个子图相互作用后得出多个结果，结果的区别是因为数据集的差异，loss也就会不同，会使整个网络的参数的训练和cnn不同）

这里出现两个难点：1、原始图像的ROI如何映射到特征图（一系列卷积层后的最后输出）。2、ROI的在特征图上的对应的特征区域的维度不满足全连接层的输入要求怎么办？

#### 空间金字塔池化 (Spatial Pyramid Pooling)

对于难点2我们分析一下：

这个问题涉及的流程主要有: 图像输入->卷积层1->池化1->...->卷积层n->池化n->全连接层。

主要是因为全连接层的输入维度是固定死了的，导致池化n的输出必须与之匹配，继而导致图像输入的尺寸必须固定

> spp中解决方法是：想办法让不同尺寸的图像也可以使池化n产生固定的输出维度，它在池化n的地方做了手脚（使用特殊池化手段：空间金字塔池化），使得不同尺寸的图像也可以使池化n产生固定的输出维度

> 还有个方法是让全连接层能够接受非固定的输入维度：将全连接层改为全卷积层，作用效果和在原始图像做滑动窗类似，多个通道并行处理，所以spp没有用

所谓的空间金字塔池化就是沿着金字塔的低端相顶端一层一层做池化

![](https://pic1.zhimg.com/80/v2-f4331c5ed1a37aa9b01314ccbf7add45_hd.jpg)

假设原图输入是224x224，对于conv5出来后的输出是13x13x256。如果像上图那样将reponse map（13x13，对应着一个filter）分成1x1